2023-06-09 00:38:22.198 +06:00 [INF] Registered 2 endpoints in 191 milliseconds.
2023-06-09 00:38:22.304 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 00:38:23.271 +06:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:38:23.286 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:38:23.305 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 00:38:23.321 +06:00 [INF] No migrations were applied. The database is already up to date.
2023-06-09 00:38:23.334 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2023-06-09 00:38:23.382 +06:00 [INF] Now listening on: http://localhost:57679
2023-06-09 00:38:23.383 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-09 00:38:23.383 +06:00 [INF] Hosting environment: Development
2023-06-09 00:38:23.383 +06:00 [INF] Content root path: /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web
2023-06-09 00:38:23.858 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/ - -
2023-06-09 00:38:23.915 +06:00 [WRN] Failed to determine the https port for redirect.
2023-06-09 00:38:23.962 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/ - - - 404 0 - 107.1453ms
2023-06-09 00:38:28.141 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/swagger/index.html - -
2023-06-09 00:38:28.217 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/swagger/index.html - - - 200 - text/html;charset=utf-8 75.9633ms
2023-06-09 00:38:28.224 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/swagger/swagger-ui.css - -
2023-06-09 00:38:28.224 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/swagger/swagger-ui-bundle.js - -
2023-06-09 00:38:28.224 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/swagger/swagger-ui-standalone-preset.js - -
2023-06-09 00:38:28.245 +06:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2023-06-09 00:38:28.245 +06:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2023-06-09 00:38:28.245 +06:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2023-06-09 00:38:28.250 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/swagger/swagger-ui-standalone-preset.js - - - 200 312163 text/javascript 25.5466ms
2023-06-09 00:38:28.250 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/swagger/swagger-ui.css - - - 200 144929 text/css 25.7654ms
2023-06-09 00:38:28.250 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/swagger/swagger-ui-bundle.js - - - 200 1061536 text/javascript 25.5542ms
2023-06-09 00:38:28.428 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/swagger/v1/swagger.json - -
2023-06-09 00:38:28.532 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 103.5851ms
2023-06-09 00:39:06.515 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts application/json 115
2023-06-09 00:39:06.518 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts'
2023-06-09 00:39:06.857 +06:00 [INF] Executed DbCommand (28ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Boolean), @p2='?' (DbType = Guid), @p3='?' (DbType = Decimal), @p4='?' (DbType = Guid), @p5='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Discounts" ("Id", "IsActive", "RootRuleGroupId", "Info_Amount", "Info_EventId", "Info_IsCumulative")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2023-06-09 00:39:06.890 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts'
2023-06-09 00:39:06.898 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts application/json 115 - 200 - application/json;+charset=utf-8 382.6481ms
2023-06-09 00:40:47.277 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/3fa85f64-5717-4562-b3fc-2c963f66afa6/AddRules application/json 299
2023-06-09 00:40:47.278 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:40:47.579 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[@__discountId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT d."Id", d."IsActive", d."RootRuleGroupId", d."Info_Amount", d."Info_EventId", d."Info_IsCumulative"
FROM "Discounts" AS d
WHERE d."Id" = @__discountId_0
LIMIT 1
2023-06-09 00:40:47.585 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:40:47.586 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts/3fa85f64-5717-4562-b3fc-2c963f66afa6/AddRules application/json 299 - 404 - - 308.9995ms
2023-06-09 00:42:53.136 +06:00 [INF] Application is shutting down...
2023-06-09 00:43:05.531 +06:00 [INF] Registered 2 endpoints in 306 milliseconds.
2023-06-09 00:43:05.680 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 00:43:06.983 +06:00 [INF] Executed DbCommand (44ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:43:07.000 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:43:07.018 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 00:43:07.037 +06:00 [INF] No migrations were applied. The database is already up to date.
2023-06-09 00:43:07.051 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2023-06-09 00:43:07.168 +06:00 [INF] Now listening on: http://localhost:57679
2023-06-09 00:43:07.169 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-09 00:43:07.169 +06:00 [INF] Hosting environment: Development
2023-06-09 00:43:07.169 +06:00 [INF] Content root path: /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web
2023-06-09 00:43:11.578 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/3fa85f64-5717-4562-b3fc-2c963f66afa6/AddRules application/json 299
2023-06-09 00:43:11.634 +06:00 [WRN] Failed to determine the https port for redirect.
2023-06-09 00:43:11.668 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:43:12.229 +06:00 [INF] Executed DbCommand (14ms) [Parameters=[@__discountId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT d."Id", d."IsActive", d."RootRuleGroupId", d."Info_Amount", d."Info_EventId", d."Info_IsCumulative"
FROM "Discounts" AS d
WHERE d."Id" = @__discountId_0
LIMIT 1
2023-06-09 00:43:12.241 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:43:12.253 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts/3fa85f64-5717-4562-b3fc-2c963f66afa6/AddRules application/json 299 - 404 - - 675.7993ms
2023-06-09 00:43:33.479 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/3fa85f64-5717-4562-b3fc-2c963f66afa6/AddRules application/json 299
2023-06-09 00:43:33.479 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:43:33.521 +06:00 [INF] Executed DbCommand (17ms) [Parameters=[@__discountId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT d."Id", d."IsActive", d."RootRuleGroupId", d."Info_Amount", d."Info_EventId", d."Info_IsCumulative"
FROM "Discounts" AS d
WHERE d."Id" = @__discountId_0
LIMIT 1
2023-06-09 00:43:33.529 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:43:33.554 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts/3fa85f64-5717-4562-b3fc-2c963f66afa6/AddRules application/json 299 - 404 - - 75.6933ms
2023-06-09 00:44:28.583 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 299
2023-06-09 00:44:28.583 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:44:28.675 +06:00 [INF] Executed DbCommand (89ms) [Parameters=[@__discountId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT d."Id", d."IsActive", d."RootRuleGroupId", d."Info_Amount", d."Info_EventId", d."Info_IsCumulative"
FROM "Discounts" AS d
WHERE d."Id" = @__discountId_0
LIMIT 1
2023-06-09 00:44:28.837 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:44:28.838 +06:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at DiscountService.Web.Endpoints.DiscountEndpoints.AddRules.HandleAsync(AddRulesRequest req, CancellationToken ct) in /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web/Endpoints/DiscountEndpoints/AddRules.cs:line 36
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Ardalis.ListStartupServices.ShowAllServicesMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2023-06-09 00:44:28.882 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 299 - 500 - text/plain;+charset=utf-8 299.0003ms
2023-06-09 00:45:47.842 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 299
2023-06-09 00:45:47.850 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:45:48.041 +06:00 [INF] Executed DbCommand (128ms) [Parameters=[@__discountId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT d."Id", d."IsActive", d."RootRuleGroupId", d."Info_Amount", d."Info_EventId", d."Info_IsCumulative"
FROM "Discounts" AS d
WHERE d."Id" = @__discountId_0
LIMIT 1
2023-06-09 00:45:48.062 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:45:48.062 +06:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at DiscountService.Web.Endpoints.DiscountEndpoints.AddRules.HandleAsync(AddRulesRequest req, CancellationToken ct) in /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web/Endpoints/DiscountEndpoints/AddRules.cs:line 36
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Ardalis.ListStartupServices.ShowAllServicesMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2023-06-09 00:45:48.064 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 299 - 500 - text/plain;+charset=utf-8 222.2170ms
2023-06-09 00:46:09.150 +06:00 [INF] Registered 2 endpoints in 318 milliseconds.
2023-06-09 00:46:09.325 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 00:46:10.543 +06:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:46:10.558 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:46:10.576 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 00:46:10.595 +06:00 [INF] No migrations were applied. The database is already up to date.
2023-06-09 00:46:10.607 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2023-06-09 00:46:10.699 +06:00 [INF] Now listening on: http://localhost:57679
2023-06-09 00:46:10.700 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-09 00:46:10.700 +06:00 [INF] Hosting environment: Development
2023-06-09 00:46:10.700 +06:00 [INF] Content root path: /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web
2023-06-09 00:46:17.455 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 299
2023-06-09 00:46:17.507 +06:00 [WRN] Failed to determine the https port for redirect.
2023-06-09 00:46:17.543 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:46:35.208 +06:00 [INF] Executed DbCommand (14ms) [Parameters=[@__discountId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT d."Id", d."IsActive", d."RootRuleGroupId", d."Info_Amount", d."Info_EventId", d."Info_IsCumulative"
FROM "Discounts" AS d
WHERE d."Id" = @__discountId_0
LIMIT 1
2023-06-09 00:46:51.200 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:46:51.200 +06:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at DiscountService.Web.Endpoints.DiscountEndpoints.AddRules.HandleAsync(AddRulesRequest req, CancellationToken ct) in /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web/Endpoints/DiscountEndpoints/AddRules.cs:line 36
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Ardalis.ListStartupServices.ShowAllServicesMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2023-06-09 00:46:51.217 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 299 - 500 - text/plain;+charset=utf-8 33763.9203ms
2023-06-09 00:47:05.662 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 299
2023-06-09 00:47:05.662 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:47:23.616 +06:00 [INF] Executed DbCommand (15ms) [Parameters=[@__discountId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT d."Id", d."IsActive", d."RootRuleGroupId", d."Info_Amount", d."Info_EventId", d."Info_IsCumulative"
FROM "Discounts" AS d
WHERE d."Id" = @__discountId_0
LIMIT 1
2023-06-09 00:47:44.472 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:47:44.478 +06:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at DiscountService.Web.Endpoints.DiscountEndpoints.AddRules.HandleAsync(AddRulesRequest req, CancellationToken ct) in /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web/Endpoints/DiscountEndpoints/AddRules.cs:line 36
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Ardalis.ListStartupServices.ShowAllServicesMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2023-06-09 00:47:44.486 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 299 - 500 - text/plain;+charset=utf-8 38824.5504ms
2023-06-09 00:47:49.922 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 299
2023-06-09 00:47:49.923 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:47:54.949 +06:00 [INF] Executed DbCommand (62ms) [Parameters=[@__discountId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT d."Id", d."IsActive", d."RootRuleGroupId", d."Info_Amount", d."Info_EventId", d."Info_IsCumulative"
FROM "Discounts" AS d
WHERE d."Id" = @__discountId_0
LIMIT 1
2023-06-09 00:48:34.684 +06:00 [INF] Registered 2 endpoints in 309 milliseconds.
2023-06-09 00:48:34.833 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 00:48:35.957 +06:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:48:35.972 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:48:35.991 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 00:48:36.008 +06:00 [INF] No migrations were applied. The database is already up to date.
2023-06-09 00:48:36.020 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2023-06-09 00:48:36.110 +06:00 [INF] Now listening on: http://localhost:57679
2023-06-09 00:48:36.110 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-09 00:48:36.110 +06:00 [INF] Hosting environment: Development
2023-06-09 00:48:36.111 +06:00 [INF] Content root path: /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web
2023-06-09 00:48:38.159 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 299
2023-06-09 00:48:38.214 +06:00 [WRN] Failed to determine the https port for redirect.
2023-06-09 00:48:38.250 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:48:54.043 +06:00 [INF] Executed DbCommand (14ms) [Parameters=[@__discountId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT d."Id", d."IsActive", d."RootRuleGroupId", d."Info_Amount", d."Info_EventId", d."Info_IsCumulative"
FROM "Discounts" AS d
WHERE d."Id" = @__discountId_0
LIMIT 1
2023-06-09 00:49:17.776 +06:00 [INF] Registered 2 endpoints in 285 milliseconds.
2023-06-09 00:49:17.913 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 00:49:19.063 +06:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:49:19.081 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:49:19.099 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 00:49:19.117 +06:00 [INF] No migrations were applied. The database is already up to date.
2023-06-09 00:49:19.128 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2023-06-09 00:49:19.202 +06:00 [INF] Now listening on: http://localhost:57679
2023-06-09 00:49:19.203 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-09 00:49:19.203 +06:00 [INF] Hosting environment: Development
2023-06-09 00:49:19.203 +06:00 [INF] Content root path: /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web
2023-06-09 00:49:21.870 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 299
2023-06-09 00:49:21.922 +06:00 [WRN] Failed to determine the https port for redirect.
2023-06-09 00:49:21.957 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:49:22.479 +06:00 [INF] Executed DbCommand (16ms) [Parameters=[@__discountId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT d."Id", d."IsActive", d."RootRuleGroupId", d."Info_Amount", d."Info_EventId", d."Info_IsCumulative"
FROM "Discounts" AS d
WHERE d."Id" = @__discountId_0
LIMIT 1
2023-06-09 00:49:22.646 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:49:22.647 +06:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at DiscountService.Web.Endpoints.DiscountEndpoints.AddRules.HandleAsync(AddRulesRequest req, CancellationToken ct) in /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web/Endpoints/DiscountEndpoints/AddRules.cs:line 36
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Ardalis.ListStartupServices.ShowAllServicesMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2023-06-09 00:49:22.698 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 299 - 500 - text/plain;+charset=utf-8 829.0172ms
2023-06-09 00:50:06.212 +06:00 [INF] Registered 2 endpoints in 293 milliseconds.
2023-06-09 00:50:06.368 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 00:50:07.567 +06:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:50:07.584 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:50:07.603 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 00:50:07.620 +06:00 [INF] No migrations were applied. The database is already up to date.
2023-06-09 00:50:07.631 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2023-06-09 00:50:07.714 +06:00 [INF] Now listening on: http://localhost:57679
2023-06-09 00:50:07.714 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-09 00:50:07.715 +06:00 [INF] Hosting environment: Development
2023-06-09 00:50:07.715 +06:00 [INF] Content root path: /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web
2023-06-09 00:50:12.234 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 301
2023-06-09 00:50:12.287 +06:00 [WRN] Failed to determine the https port for redirect.
2023-06-09 00:50:12.321 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:50:12.848 +06:00 [INF] Executed DbCommand (15ms) [Parameters=[@__discountId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT d."Id", d."IsActive", d."RootRuleGroupId", d."Info_Amount", d."Info_EventId", d."Info_IsCumulative"
FROM "Discounts" AS d
WHERE d."Id" = @__discountId_0
LIMIT 1
2023-06-09 00:50:13.013 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:50:13.014 +06:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at DiscountService.Web.Endpoints.DiscountEndpoints.AddRules.HandleAsync(AddRulesRequest req, CancellationToken ct) in /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web/Endpoints/DiscountEndpoints/AddRules.cs:line 36
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Ardalis.ListStartupServices.ShowAllServicesMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2023-06-09 00:50:13.069 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 301 - 500 - text/plain;+charset=utf-8 835.8318ms
2023-06-09 00:50:51.676 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts application/json 115
2023-06-09 00:50:51.677 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts'
2023-06-09 00:50:51.925 +06:00 [INF] Executed DbCommand (25ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Boolean), @p2='?' (DbType = Guid), @p3='?' (DbType = Decimal), @p4='?' (DbType = Guid), @p5='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Discounts" ("Id", "IsActive", "RootRuleGroupId", "Info_Amount", "Info_EventId", "Info_IsCumulative")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2023-06-09 00:50:51.963 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts'
2023-06-09 00:50:51.969 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts application/json 115 - 200 - application/json;+charset=utf-8 293.2188ms
2023-06-09 00:50:56.960 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 301
2023-06-09 00:50:56.961 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:50:56.977 +06:00 [INF] Executed DbCommand (11ms) [Parameters=[@__discountId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT d."Id", d."IsActive", d."RootRuleGroupId", d."Info_Amount", d."Info_EventId", d."Info_IsCumulative"
FROM "Discounts" AS d
WHERE d."Id" = @__discountId_0
LIMIT 1
2023-06-09 00:54:56.488 +06:00 [INF] Registered 2 endpoints in 157 milliseconds.
2023-06-09 00:54:56.573 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 00:54:57.433 +06:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:54:57.446 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:54:57.461 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 00:54:57.475 +06:00 [INF] No migrations were applied. The database is already up to date.
2023-06-09 00:54:57.485 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2023-06-09 00:54:57.522 +06:00 [INF] Now listening on: http://localhost:57679
2023-06-09 00:54:57.522 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-09 00:54:57.522 +06:00 [INF] Hosting environment: Development
2023-06-09 00:54:57.522 +06:00 [INF] Content root path: /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web
2023-06-09 00:54:58.105 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/ - -
2023-06-09 00:54:58.150 +06:00 [WRN] Failed to determine the https port for redirect.
2023-06-09 00:54:58.192 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/ - - - 404 0 - 88.6816ms
2023-06-09 00:55:02.197 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 301
2023-06-09 00:55:02.200 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:55:02.280 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:55:02.282 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 301 - 400 - application/json;+charset=utf-8 84.6614ms
2023-06-09 00:57:34.109 +06:00 [INF] Application is shutting down...
2023-06-09 00:57:41.086 +06:00 [INF] Registered 2 endpoints in 181 milliseconds.
2023-06-09 00:57:41.181 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 00:57:42.087 +06:00 [INF] Executed DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:57:42.101 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 00:57:42.116 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 00:57:42.132 +06:00 [INF] No migrations were applied. The database is already up to date.
2023-06-09 00:57:42.145 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2023-06-09 00:57:42.190 +06:00 [INF] Now listening on: http://localhost:57679
2023-06-09 00:57:42.190 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-09 00:57:42.190 +06:00 [INF] Hosting environment: Development
2023-06-09 00:57:42.190 +06:00 [INF] Content root path: /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web
2023-06-09 00:57:42.615 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/ - -
2023-06-09 00:57:42.660 +06:00 [WRN] Failed to determine the https port for redirect.
2023-06-09 00:57:42.702 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/ - - - 404 0 - 88.4248ms
2023-06-09 00:57:46.750 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 301
2023-06-09 00:57:46.753 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:57:47.137 +06:00 [INF] Executed DbCommand (11ms) [Parameters=[@__discountId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT d."Id", d."IsActive", d."RootRuleGroupId", d."Info_Amount", d."Info_EventId", d."Info_IsCumulative"
FROM "Discounts" AS d
WHERE d."Id" = @__discountId_0
LIMIT 1
2023-06-09 00:57:47.238 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:57:47.239 +06:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at DiscountService.Core.DiscountAggregate.Rules.Rule..ctor(String comparand, String ruleOperator, RuleGroup ruleGroup, String comparer, String value) in /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Core/DiscountAggregate/Rules/Rule.cs:line 26
   at DiscountService.Web.Endpoints.DTO.RuleDTO.RuleFromDTO(RuleGroup ruleGroup) in /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web/Endpoints/DTO/RuleDTO.cs:line 27
   at DiscountService.Web.Endpoints.DTO.RuleGroupDTO.<>c__DisplayClass24_0.<RuleGroupFromDTO>b__1(RuleDTO x) in /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web/Endpoints/DTO/RuleGroupDTO.cs:line 29
   at System.Linq.Enumerable.SelectListIterator`2.ToList()
   at DiscountService.Web.Endpoints.DTO.RuleGroupDTO.RuleGroupFromDTO() in /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web/Endpoints/DTO/RuleGroupDTO.cs:line 29
   at DiscountService.Web.Endpoints.DiscountEndpoints.AddRules.HandleAsync(AddRulesRequest req, CancellationToken ct) in /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web/Endpoints/DiscountEndpoints/AddRules.cs:line 36
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Ardalis.ListStartupServices.ShowAllServicesMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2023-06-09 00:57:47.256 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 301 - 500 - text/plain;+charset=utf-8 506.1798ms
2023-06-09 00:58:46.442 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 299
2023-06-09 00:58:46.443 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:58:46.497 +06:00 [INF] Executed DbCommand (7ms) [Parameters=[@__discountId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT d."Id", d."IsActive", d."RootRuleGroupId", d."Info_Amount", d."Info_EventId", d."Info_IsCumulative"
FROM "Discounts" AS d
WHERE d."Id" = @__discountId_0
LIMIT 1
2023-06-09 00:58:46.732 +06:00 [ERR] Failed executing DbCommand (19ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Int32), @p2='?' (DbType = Guid), @p4='?' (DbType = Guid), @p3='?' (DbType = Guid), @p5='?' (DbType = Guid), @p6='?' (DbType = Boolean), @p7='?' (DbType = Guid), @p8='?', @p9='?' (DbType = Object), @p10='?', @p11='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "RuleGroups" ("Id", "GroupOperator", "ParentGroupId")
VALUES (@p0, @p1, @p2);
UPDATE "Discounts" SET "RootRuleGroupId" = @p3
WHERE "Id" = @p4;
INSERT INTO "Rule" ("Id", "IsComparedToValue", "RuleGroupId", "RuleOperator", "Value", "Comparand_Address", "Comparand_Type")
VALUES (@p5, @p6, @p7, @p8, @p9, @p10, @p11);
2023-06-09 00:58:46.759 +06:00 [ERR] An exception occurred in the database while saving changes for context type 'DiscountService.Infrastructure.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 42P01: relation "RuleGroups" does not exist

POSITION: 13
   at Npgsql.Internal.NpgsqlConnector.<ReadMessage>g__ReadMessageLong|234_0(NpgsqlConnector connector, Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 42P01
    MessageText: relation "RuleGroups" does not exist
    Position: 13
    File: parse_relation.c
    Line: 1392
    Routine: parserOpenTable
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 42P01: relation "RuleGroups" does not exist

POSITION: 13
   at Npgsql.Internal.NpgsqlConnector.<ReadMessage>g__ReadMessageLong|234_0(NpgsqlConnector connector, Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 42P01
    MessageText: relation "RuleGroups" does not exist
    Position: 13
    File: parse_relation.c
    Line: 1392
    Routine: parserOpenTable
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2023-06-09 00:58:46.764 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 00:58:46.768 +06:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 42P01: relation "RuleGroups" does not exist

POSITION: 13
   at Npgsql.Internal.NpgsqlConnector.<ReadMessage>g__ReadMessageLong|234_0(NpgsqlConnector connector, Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 42P01
    MessageText: relation "RuleGroups" does not exist
    Position: 13
    File: parse_relation.c
    Line: 1392
    Routine: parserOpenTable
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at DiscountService.Infrastructure.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Infrastructure/Data/AppDbContext.cs:line 33
   at Ardalis.Specification.EntityFrameworkCore.RepositoryBase`1.SaveChangesAsync(CancellationToken cancellationToken)
   at DiscountService.Web.Endpoints.DiscountEndpoints.AddRules.HandleAsync(AddRulesRequest req, CancellationToken ct) in /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web/Endpoints/DiscountEndpoints/AddRules.cs:line 42
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Ardalis.ListStartupServices.ShowAllServicesMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2023-06-09 00:58:46.776 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts/3ed314ae-d366-448f-bff2-e533d3bbf61f/AddRules application/json 299 - 500 - text/plain;+charset=utf-8 333.6534ms
2023-06-09 00:59:19.635 +06:00 [INF] Application is shutting down...
2023-06-09 01:02:35.190 +06:00 [INF] Registered 2 endpoints in 163 milliseconds.
2023-06-09 01:02:35.277 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 01:02:36.253 +06:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE DATABASE "discount_service.local";
2023-06-09 01:02:36.344 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);
2023-06-09 01:02:36.364 +06:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:02:36.367 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 01:02:36.382 +06:00 [INF] Applying migration '20230516132521_Initial'.
2023-06-09 01:02:36.439 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Contributors" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    CONSTRAINT "PK_Contributors" PRIMARY KEY ("Id")
);
2023-06-09 01:02:36.442 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Discounts" (
    "Id" uuid NOT NULL,
    "Info_Amount" numeric NOT NULL,
    "Info_IsCumulative" boolean NOT NULL,
    "Info_EventId" uuid NOT NULL,
    "IsActive" boolean NOT NULL,
    CONSTRAINT "PK_Discounts" PRIMARY KEY ("Id")
);
2023-06-09 01:02:36.444 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Projects" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    "Priority" integer NOT NULL,
    CONSTRAINT "PK_Projects" PRIMARY KEY ("Id")
);
2023-06-09 01:02:36.446 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Conditions" (
    "Id" uuid NOT NULL,
    "DiscountId" uuid NOT NULL,
    "Type" integer NOT NULL,
    "DueDate" timestamp with time zone NULL,
    "NumberOfFirstCustomers" integer NULL,
    CONSTRAINT "PK_Conditions" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Conditions_Discounts_DiscountId" FOREIGN KEY ("DiscountId") REFERENCES "Discounts" ("Id") ON DELETE CASCADE
);
2023-06-09 01:02:36.449 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Promocode" (
    "Id" uuid NOT NULL,
    "DiscountId" uuid NOT NULL,
    "Code" text NOT NULL,
    "Amount" integer NOT NULL,
    "UsedTimes" integer NOT NULL,
    CONSTRAINT "PK_Promocode" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Promocode_Discounts_DiscountId" FOREIGN KEY ("DiscountId") REFERENCES "Discounts" ("Id") ON DELETE CASCADE
);
2023-06-09 01:02:36.452 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ToDoItems" (
    "Id" uuid NOT NULL,
    "Title" text NOT NULL,
    "Description" text NOT NULL,
    "ContributorId" uuid NULL,
    "IsDone" boolean NOT NULL,
    "ProjectId" uuid NULL,
    CONSTRAINT "PK_ToDoItems" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ToDoItems_Projects_ProjectId" FOREIGN KEY ("ProjectId") REFERENCES "Projects" ("Id")
);
2023-06-09 01:02:36.453 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Conditions_DiscountId" ON "Conditions" ("DiscountId");
2023-06-09 01:02:36.455 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Promocode_DiscountId" ON "Promocode" ("DiscountId");
2023-06-09 01:02:36.456 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ToDoItems_ProjectId" ON "ToDoItems" ("ProjectId");
2023-06-09 01:02:36.457 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230516132521_Initial', '7.0.5');
2023-06-09 01:02:36.464 +06:00 [INF] Applying migration '20230527203406_AddRules'.
2023-06-09 01:02:36.481 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Conditions";
2023-06-09 01:02:36.481 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD "RootRuleGroupId" uuid NULL;
2023-06-09 01:02:36.483 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "RuleGroups" (
    "Id" uuid NOT NULL,
    "GroupOperator" integer NOT NULL,
    "ParentGroupId" uuid NULL,
    CONSTRAINT "PK_RuleGroups" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_RuleGroups_RuleGroups_ParentGroupId" FOREIGN KEY ("ParentGroupId") REFERENCES "RuleGroups" ("Id")
);
2023-06-09 01:02:36.486 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Rule" (
    "Id" uuid NOT NULL,
    "RuleGroupId" uuid NOT NULL,
    "Comparand_Address" text NOT NULL,
    "Comparand_Type" text NOT NULL,
    "Comparer_Address" text NULL,
    "Comparer_Type" text NULL,
    "IsComparedToValue" boolean NOT NULL,
    "Value" jsonb NULL,
    "RuleOperator" text NOT NULL,
    CONSTRAINT "PK_Rule" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Rule_RuleGroups_RuleGroupId" FOREIGN KEY ("RuleGroupId") REFERENCES "RuleGroups" ("Id") ON DELETE CASCADE
);
2023-06-09 01:02:36.487 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Discounts_RootRuleGroupId" ON "Discounts" ("RootRuleGroupId");
2023-06-09 01:02:36.488 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Rule_RuleGroupId" ON "Rule" ("RuleGroupId");
2023-06-09 01:02:36.489 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_RuleGroups_ParentGroupId" ON "RuleGroups" ("ParentGroupId");
2023-06-09 01:02:36.490 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD CONSTRAINT "FK_Discounts_RuleGroups_RootRuleGroupId" FOREIGN KEY ("RootRuleGroupId") REFERENCES "RuleGroups" ("Id");
2023-06-09 01:02:36.491 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230527203406_AddRules', '7.0.5');
2023-06-09 01:02:36.492 +06:00 [INF] Applying migration '20230603174315_Test'.
2023-06-09 01:02:36.503 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" DROP CONSTRAINT "FK_Discounts_RuleGroups_RootRuleGroupId";
2023-06-09 01:02:36.504 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Rule" DROP CONSTRAINT "FK_Rule_RuleGroups_RuleGroupId";
2023-06-09 01:02:36.504 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "RuleGroups" DROP CONSTRAINT "FK_RuleGroups_RuleGroups_ParentGroupId";
2023-06-09 01:02:36.505 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Contributors";
2023-06-09 01:02:36.505 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "ToDoItems";
2023-06-09 01:02:36.506 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Projects";
2023-06-09 01:02:36.506 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "RuleGroups" DROP CONSTRAINT "PK_RuleGroups";
2023-06-09 01:02:36.506 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "RuleGroups" RENAME TO "RuleGroup";
2023-06-09 01:02:36.507 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER INDEX "IX_RuleGroups_ParentGroupId" RENAME TO "IX_RuleGroup_ParentGroupId";
2023-06-09 01:02:36.508 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "RuleGroup" ADD CONSTRAINT "PK_RuleGroup" PRIMARY KEY ("Id");
2023-06-09 01:02:36.509 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD CONSTRAINT "FK_Discounts_RuleGroup_RootRuleGroupId" FOREIGN KEY ("RootRuleGroupId") REFERENCES "RuleGroup" ("Id");
2023-06-09 01:02:36.510 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Rule" ADD CONSTRAINT "FK_Rule_RuleGroup_RuleGroupId" FOREIGN KEY ("RuleGroupId") REFERENCES "RuleGroup" ("Id") ON DELETE CASCADE;
2023-06-09 01:02:36.510 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "RuleGroup" ADD CONSTRAINT "FK_RuleGroup_RuleGroup_ParentGroupId" FOREIGN KEY ("ParentGroupId") REFERENCES "RuleGroup" ("Id");
2023-06-09 01:02:36.510 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230603174315_Test', '7.0.5');
2023-06-09 01:02:36.522 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2023-06-09 01:02:36.562 +06:00 [INF] Now listening on: http://localhost:57679
2023-06-09 01:02:36.562 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-09 01:02:36.562 +06:00 [INF] Hosting environment: Development
2023-06-09 01:02:36.562 +06:00 [INF] Content root path: /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web
2023-06-09 01:02:36.871 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/ - -
2023-06-09 01:02:36.915 +06:00 [WRN] Failed to determine the https port for redirect.
2023-06-09 01:02:36.958 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/ - - - 404 0 - 86.8966ms
2023-06-09 01:05:30.641 +06:00 [INF] Application is shutting down...
2023-06-09 01:08:00.389 +06:00 [INF] Registered 2 endpoints in 156 milliseconds.
2023-06-09 01:08:00.475 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 01:08:01.406 +06:00 [INF] Executed DbCommand (48ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE DATABASE "discount_service.local";
2023-06-09 01:08:01.492 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);
2023-06-09 01:08:01.510 +06:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:08:01.514 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 01:08:01.527 +06:00 [INF] Applying migration '20230516132521_Initial'.
2023-06-09 01:08:01.578 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Contributors" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    CONSTRAINT "PK_Contributors" PRIMARY KEY ("Id")
);
2023-06-09 01:08:01.581 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Discounts" (
    "Id" uuid NOT NULL,
    "Info_Amount" numeric NOT NULL,
    "Info_IsCumulative" boolean NOT NULL,
    "Info_EventId" uuid NOT NULL,
    "IsActive" boolean NOT NULL,
    CONSTRAINT "PK_Discounts" PRIMARY KEY ("Id")
);
2023-06-09 01:08:01.582 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Projects" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    "Priority" integer NOT NULL,
    CONSTRAINT "PK_Projects" PRIMARY KEY ("Id")
);
2023-06-09 01:08:01.585 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Conditions" (
    "Id" uuid NOT NULL,
    "DiscountId" uuid NOT NULL,
    "Type" integer NOT NULL,
    "DueDate" timestamp with time zone NULL,
    "NumberOfFirstCustomers" integer NULL,
    CONSTRAINT "PK_Conditions" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Conditions_Discounts_DiscountId" FOREIGN KEY ("DiscountId") REFERENCES "Discounts" ("Id") ON DELETE CASCADE
);
2023-06-09 01:08:01.588 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Promocode" (
    "Id" uuid NOT NULL,
    "DiscountId" uuid NOT NULL,
    "Code" text NOT NULL,
    "Amount" integer NOT NULL,
    "UsedTimes" integer NOT NULL,
    CONSTRAINT "PK_Promocode" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Promocode_Discounts_DiscountId" FOREIGN KEY ("DiscountId") REFERENCES "Discounts" ("Id") ON DELETE CASCADE
);
2023-06-09 01:08:01.591 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ToDoItems" (
    "Id" uuid NOT NULL,
    "Title" text NOT NULL,
    "Description" text NOT NULL,
    "ContributorId" uuid NULL,
    "IsDone" boolean NOT NULL,
    "ProjectId" uuid NULL,
    CONSTRAINT "PK_ToDoItems" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ToDoItems_Projects_ProjectId" FOREIGN KEY ("ProjectId") REFERENCES "Projects" ("Id")
);
2023-06-09 01:08:01.593 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Conditions_DiscountId" ON "Conditions" ("DiscountId");
2023-06-09 01:08:01.595 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Promocode_DiscountId" ON "Promocode" ("DiscountId");
2023-06-09 01:08:01.596 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ToDoItems_ProjectId" ON "ToDoItems" ("ProjectId");
2023-06-09 01:08:01.597 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230516132521_Initial', '7.0.5');
2023-06-09 01:08:01.604 +06:00 [INF] Applying migration '20230527203406_AddRules'.
2023-06-09 01:08:01.620 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Conditions";
2023-06-09 01:08:01.621 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD "RootRuleGroupId" uuid NULL;
2023-06-09 01:08:01.623 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "RuleGroups" (
    "Id" uuid NOT NULL,
    "GroupOperator" integer NOT NULL,
    "ParentGroupId" uuid NULL,
    CONSTRAINT "PK_RuleGroups" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_RuleGroups_RuleGroups_ParentGroupId" FOREIGN KEY ("ParentGroupId") REFERENCES "RuleGroups" ("Id")
);
2023-06-09 01:08:01.625 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Rule" (
    "Id" uuid NOT NULL,
    "RuleGroupId" uuid NOT NULL,
    "Comparand_Address" text NOT NULL,
    "Comparand_Type" text NOT NULL,
    "Comparer_Address" text NULL,
    "Comparer_Type" text NULL,
    "IsComparedToValue" boolean NOT NULL,
    "Value" jsonb NULL,
    "RuleOperator" text NOT NULL,
    CONSTRAINT "PK_Rule" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Rule_RuleGroups_RuleGroupId" FOREIGN KEY ("RuleGroupId") REFERENCES "RuleGroups" ("Id") ON DELETE CASCADE
);
2023-06-09 01:08:01.627 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Discounts_RootRuleGroupId" ON "Discounts" ("RootRuleGroupId");
2023-06-09 01:08:01.628 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Rule_RuleGroupId" ON "Rule" ("RuleGroupId");
2023-06-09 01:08:01.629 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_RuleGroups_ParentGroupId" ON "RuleGroups" ("ParentGroupId");
2023-06-09 01:08:01.630 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD CONSTRAINT "FK_Discounts_RuleGroups_RootRuleGroupId" FOREIGN KEY ("RootRuleGroupId") REFERENCES "RuleGroups" ("Id");
2023-06-09 01:08:01.631 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230527203406_AddRules', '7.0.5');
2023-06-09 01:08:01.633 +06:00 [INF] Applying migration '20230608190748_Latest'.
2023-06-09 01:08:01.643 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" DROP CONSTRAINT "FK_Discounts_RuleGroups_RootRuleGroupId";
2023-06-09 01:08:01.644 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Contributors";
2023-06-09 01:08:01.645 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "ToDoItems";
2023-06-09 01:08:01.645 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Projects";
2023-06-09 01:08:01.646 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" RENAME COLUMN "RootRuleGroupId" TO "DiscountId";
2023-06-09 01:08:01.646 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER INDEX "IX_Discounts_RootRuleGroupId" RENAME TO "IX_Discounts_DiscountId";
2023-06-09 01:08:01.647 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD CONSTRAINT "FK_Discounts_RuleGroups_DiscountId" FOREIGN KEY ("DiscountId") REFERENCES "RuleGroups" ("Id");
2023-06-09 01:08:01.647 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230608190748_Latest', '7.0.5');
2023-06-09 01:08:01.661 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2023-06-09 01:08:01.705 +06:00 [INF] Now listening on: http://localhost:57679
2023-06-09 01:08:01.705 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-09 01:08:01.705 +06:00 [INF] Hosting environment: Development
2023-06-09 01:08:01.705 +06:00 [INF] Content root path: /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web
2023-06-09 01:08:02.133 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/ - -
2023-06-09 01:08:02.172 +06:00 [WRN] Failed to determine the https port for redirect.
2023-06-09 01:08:02.216 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/ - - - 404 0 - 82.8694ms
2023-06-09 01:10:20.131 +06:00 [INF] Application is shutting down...
2023-06-09 01:10:41.910 +06:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:10:41.946 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 01:10:41.957 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:10:41.961 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:10:41.962 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 01:10:41.970 +06:00 [INF] Reverting migration '20230608190748_Latest'.
2023-06-09 01:10:42.003 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" DROP CONSTRAINT "FK_Discounts_RuleGroups_DiscountId";
2023-06-09 01:10:42.004 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" RENAME COLUMN "DiscountId" TO "RootRuleGroupId";
2023-06-09 01:10:42.004 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER INDEX "IX_Discounts_DiscountId" RENAME TO "IX_Discounts_RootRuleGroupId";
2023-06-09 01:10:42.006 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Contributors" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    CONSTRAINT "PK_Contributors" PRIMARY KEY ("Id")
);
2023-06-09 01:10:42.007 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Projects" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    "Priority" integer NOT NULL,
    CONSTRAINT "PK_Projects" PRIMARY KEY ("Id")
);
2023-06-09 01:10:42.010 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ToDoItems" (
    "Id" uuid NOT NULL,
    "ContributorId" uuid NULL,
    "Description" text NOT NULL,
    "IsDone" boolean NOT NULL,
    "ProjectId" uuid NULL,
    "Title" text NOT NULL,
    CONSTRAINT "PK_ToDoItems" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ToDoItems_Projects_ProjectId" FOREIGN KEY ("ProjectId") REFERENCES "Projects" ("Id")
);
2023-06-09 01:10:42.012 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ToDoItems_ProjectId" ON "ToDoItems" ("ProjectId");
2023-06-09 01:10:42.012 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD CONSTRAINT "FK_Discounts_RuleGroups_RootRuleGroupId" FOREIGN KEY ("RootRuleGroupId") REFERENCES "RuleGroups" ("Id");
2023-06-09 01:10:42.013 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsHistory"
WHERE "MigrationId" = '20230608190748_Latest';
2023-06-09 01:11:04.882 +06:00 [INF] Registered 2 endpoints in 159 milliseconds.
2023-06-09 01:11:04.970 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 01:11:05.869 +06:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:11:05.882 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:11:05.896 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 01:11:05.912 +06:00 [INF] Applying migration '20230608191056_Latest'.
2023-06-09 01:11:05.953 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" DROP CONSTRAINT "FK_Discounts_RuleGroups_RootRuleGroupId";
2023-06-09 01:11:05.953 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Contributors";
2023-06-09 01:11:05.954 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "ToDoItems";
2023-06-09 01:11:05.954 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Projects";
2023-06-09 01:11:05.955 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP INDEX "IX_Discounts_RootRuleGroupId";
2023-06-09 01:11:05.955 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" DROP COLUMN "RootRuleGroupId";
2023-06-09 01:11:05.955 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "RuleGroups" ADD "RootRuleGroupId" uuid NULL;
2023-06-09 01:11:05.957 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_RuleGroups_RootRuleGroupId" ON "RuleGroups" ("RootRuleGroupId");
2023-06-09 01:11:05.958 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "RuleGroups" ADD CONSTRAINT "FK_RuleGroups_Discounts_RootRuleGroupId" FOREIGN KEY ("RootRuleGroupId") REFERENCES "Discounts" ("Id");
2023-06-09 01:11:05.959 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230608191056_Latest', '7.0.5');
2023-06-09 01:11:05.974 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2023-06-09 01:11:06.011 +06:00 [INF] Now listening on: http://localhost:57679
2023-06-09 01:11:06.011 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-09 01:11:06.011 +06:00 [INF] Hosting environment: Development
2023-06-09 01:11:06.011 +06:00 [INF] Content root path: /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web
2023-06-09 01:11:06.540 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/ - -
2023-06-09 01:11:06.585 +06:00 [WRN] Failed to determine the https port for redirect.
2023-06-09 01:11:06.625 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/ - - - 404 0 - 86.5397ms
2023-06-09 01:11:26.800 +06:00 [INF] Application is shutting down...
2023-06-09 01:11:41.260 +06:00 [INF] Registered 2 endpoints in 161 milliseconds.
2023-06-09 01:11:41.352 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 01:11:42.277 +06:00 [INF] Executed DbCommand (45ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE DATABASE "discount_service.local";
2023-06-09 01:11:42.373 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);
2023-06-09 01:11:42.394 +06:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:11:42.397 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 01:11:42.413 +06:00 [INF] Applying migration '20230516132521_Initial'.
2023-06-09 01:11:42.468 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Contributors" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    CONSTRAINT "PK_Contributors" PRIMARY KEY ("Id")
);
2023-06-09 01:11:42.471 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Discounts" (
    "Id" uuid NOT NULL,
    "Info_Amount" numeric NOT NULL,
    "Info_IsCumulative" boolean NOT NULL,
    "Info_EventId" uuid NOT NULL,
    "IsActive" boolean NOT NULL,
    CONSTRAINT "PK_Discounts" PRIMARY KEY ("Id")
);
2023-06-09 01:11:42.472 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Projects" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    "Priority" integer NOT NULL,
    CONSTRAINT "PK_Projects" PRIMARY KEY ("Id")
);
2023-06-09 01:11:42.474 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Conditions" (
    "Id" uuid NOT NULL,
    "DiscountId" uuid NOT NULL,
    "Type" integer NOT NULL,
    "DueDate" timestamp with time zone NULL,
    "NumberOfFirstCustomers" integer NULL,
    CONSTRAINT "PK_Conditions" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Conditions_Discounts_DiscountId" FOREIGN KEY ("DiscountId") REFERENCES "Discounts" ("Id") ON DELETE CASCADE
);
2023-06-09 01:11:42.477 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Promocode" (
    "Id" uuid NOT NULL,
    "DiscountId" uuid NOT NULL,
    "Code" text NOT NULL,
    "Amount" integer NOT NULL,
    "UsedTimes" integer NOT NULL,
    CONSTRAINT "PK_Promocode" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Promocode_Discounts_DiscountId" FOREIGN KEY ("DiscountId") REFERENCES "Discounts" ("Id") ON DELETE CASCADE
);
2023-06-09 01:11:42.481 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ToDoItems" (
    "Id" uuid NOT NULL,
    "Title" text NOT NULL,
    "Description" text NOT NULL,
    "ContributorId" uuid NULL,
    "IsDone" boolean NOT NULL,
    "ProjectId" uuid NULL,
    CONSTRAINT "PK_ToDoItems" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ToDoItems_Projects_ProjectId" FOREIGN KEY ("ProjectId") REFERENCES "Projects" ("Id")
);
2023-06-09 01:11:42.482 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Conditions_DiscountId" ON "Conditions" ("DiscountId");
2023-06-09 01:11:42.484 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Promocode_DiscountId" ON "Promocode" ("DiscountId");
2023-06-09 01:11:42.485 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ToDoItems_ProjectId" ON "ToDoItems" ("ProjectId");
2023-06-09 01:11:42.486 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230516132521_Initial', '7.0.5');
2023-06-09 01:11:42.493 +06:00 [INF] Applying migration '20230527203406_AddRules'.
2023-06-09 01:11:42.512 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Conditions";
2023-06-09 01:11:42.513 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD "RootRuleGroupId" uuid NULL;
2023-06-09 01:11:42.515 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "RuleGroups" (
    "Id" uuid NOT NULL,
    "GroupOperator" integer NOT NULL,
    "ParentGroupId" uuid NULL,
    CONSTRAINT "PK_RuleGroups" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_RuleGroups_RuleGroups_ParentGroupId" FOREIGN KEY ("ParentGroupId") REFERENCES "RuleGroups" ("Id")
);
2023-06-09 01:11:42.518 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Rule" (
    "Id" uuid NOT NULL,
    "RuleGroupId" uuid NOT NULL,
    "Comparand_Address" text NOT NULL,
    "Comparand_Type" text NOT NULL,
    "Comparer_Address" text NULL,
    "Comparer_Type" text NULL,
    "IsComparedToValue" boolean NOT NULL,
    "Value" jsonb NULL,
    "RuleOperator" text NOT NULL,
    CONSTRAINT "PK_Rule" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Rule_RuleGroups_RuleGroupId" FOREIGN KEY ("RuleGroupId") REFERENCES "RuleGroups" ("Id") ON DELETE CASCADE
);
2023-06-09 01:11:42.519 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Discounts_RootRuleGroupId" ON "Discounts" ("RootRuleGroupId");
2023-06-09 01:11:42.521 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Rule_RuleGroupId" ON "Rule" ("RuleGroupId");
2023-06-09 01:11:42.523 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_RuleGroups_ParentGroupId" ON "RuleGroups" ("ParentGroupId");
2023-06-09 01:11:42.524 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD CONSTRAINT "FK_Discounts_RuleGroups_RootRuleGroupId" FOREIGN KEY ("RootRuleGroupId") REFERENCES "RuleGroups" ("Id");
2023-06-09 01:11:42.524 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230527203406_AddRules', '7.0.5');
2023-06-09 01:11:42.526 +06:00 [INF] Applying migration '20230608191056_Latest'.
2023-06-09 01:11:42.537 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" DROP CONSTRAINT "FK_Discounts_RuleGroups_RootRuleGroupId";
2023-06-09 01:11:42.537 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Contributors";
2023-06-09 01:11:42.538 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "ToDoItems";
2023-06-09 01:11:42.538 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Projects";
2023-06-09 01:11:42.539 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP INDEX "IX_Discounts_RootRuleGroupId";
2023-06-09 01:11:42.539 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" DROP COLUMN "RootRuleGroupId";
2023-06-09 01:11:42.539 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "RuleGroups" ADD "RootRuleGroupId" uuid NULL;
2023-06-09 01:11:42.541 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_RuleGroups_RootRuleGroupId" ON "RuleGroups" ("RootRuleGroupId");
2023-06-09 01:11:42.543 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "RuleGroups" ADD CONSTRAINT "FK_RuleGroups_Discounts_RootRuleGroupId" FOREIGN KEY ("RootRuleGroupId") REFERENCES "Discounts" ("Id");
2023-06-09 01:11:42.543 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230608191056_Latest', '7.0.5');
2023-06-09 01:11:42.554 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2023-06-09 01:11:42.594 +06:00 [INF] Now listening on: http://localhost:57679
2023-06-09 01:11:42.594 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-09 01:11:42.594 +06:00 [INF] Hosting environment: Development
2023-06-09 01:11:42.594 +06:00 [INF] Content root path: /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web
2023-06-09 01:11:42.925 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/ - -
2023-06-09 01:11:42.970 +06:00 [WRN] Failed to determine the https port for redirect.
2023-06-09 01:11:43.008 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/ - - - 404 0 - 84.4207ms
2023-06-09 01:13:39.018 +06:00 [INF] Application is shutting down...
2023-06-09 01:16:08.889 +06:00 [INF] Registered 2 endpoints in 162 milliseconds.
2023-06-09 01:16:08.979 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 01:16:28.578 +06:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:16:28.614 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 01:16:28.625 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:16:28.629 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:16:28.630 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 01:16:28.638 +06:00 [INF] Reverting migration '20230608191056_Latest'.
2023-06-09 01:16:28.669 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "RuleGroups" DROP CONSTRAINT "FK_RuleGroups_Discounts_RootRuleGroupId";
2023-06-09 01:16:28.670 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP INDEX "IX_RuleGroups_RootRuleGroupId";
2023-06-09 01:16:28.670 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "RuleGroups" DROP COLUMN "RootRuleGroupId";
2023-06-09 01:16:28.671 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD "RootRuleGroupId" uuid NULL;
2023-06-09 01:16:28.673 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Contributors" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    CONSTRAINT "PK_Contributors" PRIMARY KEY ("Id")
);
2023-06-09 01:16:28.674 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Projects" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    "Priority" integer NOT NULL,
    CONSTRAINT "PK_Projects" PRIMARY KEY ("Id")
);
2023-06-09 01:16:28.677 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ToDoItems" (
    "Id" uuid NOT NULL,
    "ContributorId" uuid NULL,
    "Description" text NOT NULL,
    "IsDone" boolean NOT NULL,
    "ProjectId" uuid NULL,
    "Title" text NOT NULL,
    CONSTRAINT "PK_ToDoItems" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ToDoItems_Projects_ProjectId" FOREIGN KEY ("ProjectId") REFERENCES "Projects" ("Id")
);
2023-06-09 01:16:28.678 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Discounts_RootRuleGroupId" ON "Discounts" ("RootRuleGroupId");
2023-06-09 01:16:28.679 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ToDoItems_ProjectId" ON "ToDoItems" ("ProjectId");
2023-06-09 01:16:28.679 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD CONSTRAINT "FK_Discounts_RuleGroups_RootRuleGroupId" FOREIGN KEY ("RootRuleGroupId") REFERENCES "RuleGroups" ("Id");
2023-06-09 01:16:28.680 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsHistory"
WHERE "MigrationId" = '20230608191056_Latest';
2023-06-09 01:17:04.496 +06:00 [INF] Registered 2 endpoints in 159 milliseconds.
2023-06-09 01:17:04.582 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 01:17:05.547 +06:00 [INF] Executed DbCommand (43ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE DATABASE "discount_service.local";
2023-06-09 01:17:05.633 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);
2023-06-09 01:17:05.653 +06:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:17:05.656 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 01:17:05.670 +06:00 [INF] Applying migration '20230516132521_Initial'.
2023-06-09 01:17:05.728 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Contributors" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    CONSTRAINT "PK_Contributors" PRIMARY KEY ("Id")
);
2023-06-09 01:17:05.730 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Discounts" (
    "Id" uuid NOT NULL,
    "Info_Amount" numeric NOT NULL,
    "Info_IsCumulative" boolean NOT NULL,
    "Info_EventId" uuid NOT NULL,
    "IsActive" boolean NOT NULL,
    CONSTRAINT "PK_Discounts" PRIMARY KEY ("Id")
);
2023-06-09 01:17:05.732 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Projects" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    "Priority" integer NOT NULL,
    CONSTRAINT "PK_Projects" PRIMARY KEY ("Id")
);
2023-06-09 01:17:05.733 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Conditions" (
    "Id" uuid NOT NULL,
    "DiscountId" uuid NOT NULL,
    "Type" integer NOT NULL,
    "DueDate" timestamp with time zone NULL,
    "NumberOfFirstCustomers" integer NULL,
    CONSTRAINT "PK_Conditions" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Conditions_Discounts_DiscountId" FOREIGN KEY ("DiscountId") REFERENCES "Discounts" ("Id") ON DELETE CASCADE
);
2023-06-09 01:17:05.736 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Promocode" (
    "Id" uuid NOT NULL,
    "DiscountId" uuid NOT NULL,
    "Code" text NOT NULL,
    "Amount" integer NOT NULL,
    "UsedTimes" integer NOT NULL,
    CONSTRAINT "PK_Promocode" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Promocode_Discounts_DiscountId" FOREIGN KEY ("DiscountId") REFERENCES "Discounts" ("Id") ON DELETE CASCADE
);
2023-06-09 01:17:05.738 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ToDoItems" (
    "Id" uuid NOT NULL,
    "Title" text NOT NULL,
    "Description" text NOT NULL,
    "ContributorId" uuid NULL,
    "IsDone" boolean NOT NULL,
    "ProjectId" uuid NULL,
    CONSTRAINT "PK_ToDoItems" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ToDoItems_Projects_ProjectId" FOREIGN KEY ("ProjectId") REFERENCES "Projects" ("Id")
);
2023-06-09 01:17:05.740 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Conditions_DiscountId" ON "Conditions" ("DiscountId");
2023-06-09 01:17:05.741 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Promocode_DiscountId" ON "Promocode" ("DiscountId");
2023-06-09 01:17:05.742 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ToDoItems_ProjectId" ON "ToDoItems" ("ProjectId");
2023-06-09 01:17:05.743 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230516132521_Initial', '7.0.5');
2023-06-09 01:17:05.750 +06:00 [INF] Applying migration '20230527203406_AddRules'.
2023-06-09 01:17:05.767 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Conditions";
2023-06-09 01:17:05.767 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD "RootRuleGroupId" uuid NULL;
2023-06-09 01:17:05.769 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "RuleGroups" (
    "Id" uuid NOT NULL,
    "GroupOperator" integer NOT NULL,
    "ParentGroupId" uuid NULL,
    CONSTRAINT "PK_RuleGroups" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_RuleGroups_RuleGroups_ParentGroupId" FOREIGN KEY ("ParentGroupId") REFERENCES "RuleGroups" ("Id")
);
2023-06-09 01:17:05.772 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Rule" (
    "Id" uuid NOT NULL,
    "RuleGroupId" uuid NOT NULL,
    "Comparand_Address" text NOT NULL,
    "Comparand_Type" text NOT NULL,
    "Comparer_Address" text NULL,
    "Comparer_Type" text NULL,
    "IsComparedToValue" boolean NOT NULL,
    "Value" jsonb NULL,
    "RuleOperator" text NOT NULL,
    CONSTRAINT "PK_Rule" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Rule_RuleGroups_RuleGroupId" FOREIGN KEY ("RuleGroupId") REFERENCES "RuleGroups" ("Id") ON DELETE CASCADE
);
2023-06-09 01:17:05.773 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Discounts_RootRuleGroupId" ON "Discounts" ("RootRuleGroupId");
2023-06-09 01:17:05.774 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Rule_RuleGroupId" ON "Rule" ("RuleGroupId");
2023-06-09 01:17:05.775 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_RuleGroups_ParentGroupId" ON "RuleGroups" ("ParentGroupId");
2023-06-09 01:17:05.777 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD CONSTRAINT "FK_Discounts_RuleGroups_RootRuleGroupId" FOREIGN KEY ("RootRuleGroupId") REFERENCES "RuleGroups" ("Id");
2023-06-09 01:17:05.777 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230527203406_AddRules', '7.0.5');
2023-06-09 01:17:05.778 +06:00 [INF] Applying migration '20230608191647_Latest'.
2023-06-09 01:17:05.790 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" DROP CONSTRAINT "FK_Discounts_RuleGroups_RootRuleGroupId";
2023-06-09 01:17:05.791 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Contributors";
2023-06-09 01:17:05.792 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "ToDoItems";
2023-06-09 01:17:05.792 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Projects";
2023-06-09 01:17:05.792 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP INDEX "IX_Discounts_RootRuleGroupId";
2023-06-09 01:17:05.793 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" DROP COLUMN "RootRuleGroupId";
2023-06-09 01:17:05.794 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD CONSTRAINT "FK_Discounts_RuleGroups_Id" FOREIGN KEY ("Id") REFERENCES "RuleGroups" ("Id") ON DELETE CASCADE;
2023-06-09 01:17:05.794 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230608191647_Latest', '7.0.5');
2023-06-09 01:17:05.806 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2023-06-09 01:17:05.850 +06:00 [INF] Now listening on: http://localhost:57679
2023-06-09 01:17:05.851 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-09 01:17:05.851 +06:00 [INF] Hosting environment: Development
2023-06-09 01:17:05.851 +06:00 [INF] Content root path: /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web
2023-06-09 01:17:06.163 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/ - -
2023-06-09 01:17:06.208 +06:00 [WRN] Failed to determine the https port for redirect.
2023-06-09 01:17:06.248 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/ - - - 404 0 - 87.0953ms
2023-06-09 01:18:35.818 +06:00 [INF] Application is shutting down...
2023-06-09 01:20:39.951 +06:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:20:39.988 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 01:20:39.999 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:20:40.003 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:20:40.004 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 01:20:40.012 +06:00 [INF] Reverting migration '20230608191647_Latest'.
2023-06-09 01:20:40.043 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" DROP CONSTRAINT "FK_Discounts_RuleGroups_Id";
2023-06-09 01:20:40.044 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD "RootRuleGroupId" uuid NULL;
2023-06-09 01:20:40.046 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Contributors" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    CONSTRAINT "PK_Contributors" PRIMARY KEY ("Id")
);
2023-06-09 01:20:40.047 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Projects" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    "Priority" integer NOT NULL,
    CONSTRAINT "PK_Projects" PRIMARY KEY ("Id")
);
2023-06-09 01:20:40.050 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ToDoItems" (
    "Id" uuid NOT NULL,
    "ContributorId" uuid NULL,
    "Description" text NOT NULL,
    "IsDone" boolean NOT NULL,
    "ProjectId" uuid NULL,
    "Title" text NOT NULL,
    CONSTRAINT "PK_ToDoItems" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ToDoItems_Projects_ProjectId" FOREIGN KEY ("ProjectId") REFERENCES "Projects" ("Id")
);
2023-06-09 01:20:40.051 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Discounts_RootRuleGroupId" ON "Discounts" ("RootRuleGroupId");
2023-06-09 01:20:40.052 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ToDoItems_ProjectId" ON "ToDoItems" ("ProjectId");
2023-06-09 01:20:40.052 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD CONSTRAINT "FK_Discounts_RuleGroups_RootRuleGroupId" FOREIGN KEY ("RootRuleGroupId") REFERENCES "RuleGroups" ("Id");
2023-06-09 01:20:40.053 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsHistory"
WHERE "MigrationId" = '20230608191647_Latest';
2023-06-09 01:21:12.628 +06:00 [INF] Registered 2 endpoints in 163 milliseconds.
2023-06-09 01:21:12.714 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 01:21:13.691 +06:00 [INF] Executed DbCommand (42ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE DATABASE "discount_service.local";
2023-06-09 01:21:13.782 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);
2023-06-09 01:21:13.805 +06:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 01:21:13.809 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 01:21:13.825 +06:00 [INF] Applying migration '20230516132521_Initial'.
2023-06-09 01:21:13.881 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Contributors" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    CONSTRAINT "PK_Contributors" PRIMARY KEY ("Id")
);
2023-06-09 01:21:13.884 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Discounts" (
    "Id" uuid NOT NULL,
    "Info_Amount" numeric NOT NULL,
    "Info_IsCumulative" boolean NOT NULL,
    "Info_EventId" uuid NOT NULL,
    "IsActive" boolean NOT NULL,
    CONSTRAINT "PK_Discounts" PRIMARY KEY ("Id")
);
2023-06-09 01:21:13.886 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Projects" (
    "Id" uuid NOT NULL,
    "Name" character varying(100) NOT NULL,
    "Priority" integer NOT NULL,
    CONSTRAINT "PK_Projects" PRIMARY KEY ("Id")
);
2023-06-09 01:21:13.888 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Conditions" (
    "Id" uuid NOT NULL,
    "DiscountId" uuid NOT NULL,
    "Type" integer NOT NULL,
    "DueDate" timestamp with time zone NULL,
    "NumberOfFirstCustomers" integer NULL,
    CONSTRAINT "PK_Conditions" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Conditions_Discounts_DiscountId" FOREIGN KEY ("DiscountId") REFERENCES "Discounts" ("Id") ON DELETE CASCADE
);
2023-06-09 01:21:13.890 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Promocode" (
    "Id" uuid NOT NULL,
    "DiscountId" uuid NOT NULL,
    "Code" text NOT NULL,
    "Amount" integer NOT NULL,
    "UsedTimes" integer NOT NULL,
    CONSTRAINT "PK_Promocode" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Promocode_Discounts_DiscountId" FOREIGN KEY ("DiscountId") REFERENCES "Discounts" ("Id") ON DELETE CASCADE
);
2023-06-09 01:21:13.894 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ToDoItems" (
    "Id" uuid NOT NULL,
    "Title" text NOT NULL,
    "Description" text NOT NULL,
    "ContributorId" uuid NULL,
    "IsDone" boolean NOT NULL,
    "ProjectId" uuid NULL,
    CONSTRAINT "PK_ToDoItems" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ToDoItems_Projects_ProjectId" FOREIGN KEY ("ProjectId") REFERENCES "Projects" ("Id")
);
2023-06-09 01:21:13.896 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Conditions_DiscountId" ON "Conditions" ("DiscountId");
2023-06-09 01:21:13.897 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Promocode_DiscountId" ON "Promocode" ("DiscountId");
2023-06-09 01:21:13.898 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ToDoItems_ProjectId" ON "ToDoItems" ("ProjectId");
2023-06-09 01:21:13.899 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230516132521_Initial', '7.0.5');
2023-06-09 01:21:13.906 +06:00 [INF] Applying migration '20230527203406_AddRules'.
2023-06-09 01:21:13.926 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Conditions";
2023-06-09 01:21:13.926 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD "RootRuleGroupId" uuid NULL;
2023-06-09 01:21:13.929 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "RuleGroups" (
    "Id" uuid NOT NULL,
    "GroupOperator" integer NOT NULL,
    "ParentGroupId" uuid NULL,
    CONSTRAINT "PK_RuleGroups" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_RuleGroups_RuleGroups_ParentGroupId" FOREIGN KEY ("ParentGroupId") REFERENCES "RuleGroups" ("Id")
);
2023-06-09 01:21:13.932 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Rule" (
    "Id" uuid NOT NULL,
    "RuleGroupId" uuid NOT NULL,
    "Comparand_Address" text NOT NULL,
    "Comparand_Type" text NOT NULL,
    "Comparer_Address" text NULL,
    "Comparer_Type" text NULL,
    "IsComparedToValue" boolean NOT NULL,
    "Value" jsonb NULL,
    "RuleOperator" text NOT NULL,
    CONSTRAINT "PK_Rule" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Rule_RuleGroups_RuleGroupId" FOREIGN KEY ("RuleGroupId") REFERENCES "RuleGroups" ("Id") ON DELETE CASCADE
);
2023-06-09 01:21:13.934 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Discounts_RootRuleGroupId" ON "Discounts" ("RootRuleGroupId");
2023-06-09 01:21:13.935 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Rule_RuleGroupId" ON "Rule" ("RuleGroupId");
2023-06-09 01:21:13.937 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_RuleGroups_ParentGroupId" ON "RuleGroups" ("ParentGroupId");
2023-06-09 01:21:13.938 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" ADD CONSTRAINT "FK_Discounts_RuleGroups_RootRuleGroupId" FOREIGN KEY ("RootRuleGroupId") REFERENCES "RuleGroups" ("Id");
2023-06-09 01:21:13.938 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230527203406_AddRules', '7.0.5');
2023-06-09 01:21:13.940 +06:00 [INF] Applying migration '20230608192056_Latest'.
2023-06-09 01:21:13.951 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" DROP CONSTRAINT "FK_Discounts_RuleGroups_RootRuleGroupId";
2023-06-09 01:21:13.951 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Contributors";
2023-06-09 01:21:13.952 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "ToDoItems";
2023-06-09 01:21:13.953 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Projects";
2023-06-09 01:21:13.953 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP INDEX "IX_Discounts_RootRuleGroupId";
2023-06-09 01:21:13.954 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Discounts" DROP COLUMN "RootRuleGroupId";
2023-06-09 01:21:13.954 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "RuleGroups" ADD "DiscountId" uuid NULL;
2023-06-09 01:21:13.956 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_RuleGroups_DiscountId" ON "RuleGroups" ("DiscountId");
2023-06-09 01:21:13.957 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "RuleGroups" ADD CONSTRAINT "FK_RuleGroups_Discounts_DiscountId" FOREIGN KEY ("DiscountId") REFERENCES "Discounts" ("Id");
2023-06-09 01:21:13.957 +06:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230608192056_Latest', '7.0.5');
2023-06-09 01:21:13.971 +06:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2023-06-09 01:21:14.014 +06:00 [INF] Now listening on: http://localhost:57679
2023-06-09 01:21:14.014 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-09 01:21:14.014 +06:00 [INF] Hosting environment: Development
2023-06-09 01:21:14.014 +06:00 [INF] Content root path: /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web
2023-06-09 01:21:14.297 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/ - -
2023-06-09 01:21:14.347 +06:00 [WRN] Failed to determine the https port for redirect.
2023-06-09 01:21:14.388 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/ - - - 404 0 - 93.4284ms
2023-06-09 01:21:52.593 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts application/json 115
2023-06-09 01:21:52.596 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts'
2023-06-09 01:21:52.952 +06:00 [INF] Executed DbCommand (27ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Boolean), @p2='?' (DbType = Decimal), @p3='?' (DbType = Guid), @p4='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Discounts" ("Id", "IsActive", "Info_Amount", "Info_EventId", "Info_IsCumulative")
VALUES (@p0, @p1, @p2, @p3, @p4);
2023-06-09 01:21:52.990 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts'
2023-06-09 01:21:53.004 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts application/json 115 - 200 - application/json;+charset=utf-8 410.5144ms
2023-06-09 01:22:09.012 +06:00 [INF] Request starting HTTP/1.1 POST http://localhost:57679/Discounts/ec5cd454-4752-453a-b465-ef4aaaeabb0f/AddRules application/json 299
2023-06-09 01:22:09.013 +06:00 [INF] Executing endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 01:22:09.332 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[@__discountId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT d."Id", d."IsActive", d."Info_Amount", d."Info_EventId", d."Info_IsCumulative"
FROM "Discounts" AS d
WHERE d."Id" = @__discountId_0
LIMIT 1
2023-06-09 01:22:09.462 +06:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Guid), @p2='?' (DbType = Int32), @p3='?' (DbType = Guid), @p4='?' (DbType = Guid), @p5='?' (DbType = Boolean), @p6='?' (DbType = Guid), @p7='?', @p8='?' (DbType = Object), @p9='?', @p10='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "RuleGroups" ("Id", "DiscountId", "GroupOperator", "ParentGroupId")
VALUES (@p0, @p1, @p2, @p3);
INSERT INTO "Rule" ("Id", "IsComparedToValue", "RuleGroupId", "RuleOperator", "Value", "Comparand_Address", "Comparand_Type")
VALUES (@p4, @p5, @p6, @p7, @p8, @p9, @p10);
2023-06-09 01:22:09.482 +06:00 [INF] Executed endpoint 'HTTP: POST /Discounts/{DiscountId}/AddRules'
2023-06-09 01:22:09.482 +06:00 [INF] Request finished HTTP/1.1 POST http://localhost:57679/Discounts/ec5cd454-4752-453a-b465-ef4aaaeabb0f/AddRules application/json 299 - 200 - application/json;+charset=utf-8 470.1318ms
2023-06-09 01:23:45.917 +06:00 [INF] Application is shutting down...
2023-06-09 03:29:52.961 +06:00 [INF] Registered 2 endpoints in 163 milliseconds.
2023-06-09 03:29:53.053 +06:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2023-06-09 03:29:53.917 +06:00 [INF] Executed DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 03:29:53.933 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (SELECT 1 FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relname='__EFMigrationsHistory');
2023-06-09 03:29:53.948 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2023-06-09 03:29:53.965 +06:00 [INF] No migrations were applied. The database is already up to date.
2023-06-09 03:29:53.976 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2023-06-09 03:29:54.019 +06:00 [INF] Now listening on: http://localhost:57679
2023-06-09 03:29:54.019 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-09 03:29:54.019 +06:00 [INF] Hosting environment: Development
2023-06-09 03:29:54.019 +06:00 [INF] Content root path: /home/aleksandrshatalov/RiderProjects/tempppp/CSharpProCourse/DiscountService/src/DiscountService.Web
2023-06-09 03:29:54.754 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/ - -
2023-06-09 03:29:54.804 +06:00 [WRN] Failed to determine the https port for redirect.
2023-06-09 03:29:54.851 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/ - - - 404 0 - 98.7281ms
2023-06-09 03:30:05.171 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/swagger/index.html - -
2023-06-09 03:30:05.259 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/swagger/index.html - - - 200 - text/html;charset=utf-8 87.6041ms
2023-06-09 03:30:05.500 +06:00 [INF] Request starting HTTP/1.1 GET http://localhost:57679/swagger/v1/swagger.json - -
2023-06-09 03:30:05.607 +06:00 [INF] Request finished HTTP/1.1 GET http://localhost:57679/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 106.6927ms
2023-06-09 03:59:45.159 +06:00 [INF] Application is shutting down...
